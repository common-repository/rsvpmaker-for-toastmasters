"use strict";(globalThis.webpackChunktoastmasters_dynamic_agenda=globalThis.webpackChunktoastmasters_dynamic_agenda||[]).push([[436],{436:(e,t,a)=>{a.r(t),a.d(t,{default:()=>v});var l=a(462),n=a(307),o=a(196),r=a(766),s=a(609),i=a(5),c=a(538),m=a(767),d=a(74),u=a(888),g=a(921);function p(e){const[t,a]=(0,o.useState)(null),[l,i]=(0,o.useState)(!1),[c,p]=(0,o.useState)(!1),[b,k]=(0,o.useState)({uid:""}),[E,h]=(0,o.useState)([]),{blockindex:w,insertBlock:v,moveBlock:f,post_id:_,data:N,makeNotification:C}=e,x=(0,o.useRef)(null),S=(0,m.useQueryClient)(),{isLoading:y,isSuccess:T,isError:D,data:A,error:B,refetch:H}=(0,m.useQuery)("rolelist",(function(){return r.Z.get("roles_list")}),{enabled:!0,retry:2,onSuccess:function(e){h(e.data)},onError:function(e){console.log("inserter mutate error",e)}});function M(){return(0,n.createElement)(n.Fragment,null,!(t||c)&&(0,n.createElement)("p",null,(0,n.createElement)("button",{className:"blockmove deletebutton",onClick:()=>{p(!0)}},(0,n.createElement)(g.HG,null)," Delete"))," ",c&&(0,n.createElement)("p",null,(0,n.createElement)("button",{className:"blockmove",onClick:()=>{f(w,"delete",N)}},(0,n.createElement)(g.HG,null)," Confirm Delete"))," ",!t&&(0,n.createElement)("div",null,(0,n.createElement)(s.RadioControl,{className:"radio-inserter radio-mode",selected:t,label:"Insert Below",onChange:e=>function(e){"wp4toastmasters/role"==e?k({role:"",count:1,time_allowed:0,padding_time:0,backup:!1}):"wp4toastmasters/agendaedit"==e?(v(w,{time_allowed:0,uid:"note"+Date.now(),editable:"New editable note"},e),e="",i(!1)):"wp4toastmasters/agendanoterich2"==e?(v(w,{time_allowed:0,uid:"note"+Date.now()},e,'<p class="wp-block-wp4toastmasters-agendanoterich2">new agenda note</p>'),e="",i(!1)):"wp4toastmasters/signupnote"==e?(v(w,{uid:"note"+Date.now()},e,'<p class="wp-block-wp4toastmasters-signupnote">new signup form note</p>'),e="",i(!1)):"wp4toastmasters/absences"==e&&(v(w,{show_on_agenda:"1"},e),e="",i(!1)),a(e)}(e),options:[{label:"Role",value:"wp4toastmasters/role"},{label:"Agenda Note",value:"wp4toastmasters/agendanoterich2"},{label:"Editable Note",value:"wp4toastmasters/agendaedit"},{label:"Signup Note",value:"wp4toastmasters/signupnote"},{label:"Track Absences",value:"wp4toastmasters/absences"}]})))}function I(){v(w,b,t),a("")}function L(e,t,a){let l;return"Speaker"==t?(l=7*a,e<l&&(e=l)):"Evaluator"==t&&(l=3*a,e<l&&(e=l)),e}return(0,m.useMutation)((e=>{r.Z.post("editable_note_json",e)}),{onError:(e,t,a)=>{console.log("inserter editable note error",e),S.setQueryData("blocks-data",a)},onSuccess:()=>{C("Updated editable note")}}),"wp4toastmasters/role"==t?(0,n.createElement)("div",{className:"insertroleform"},(0,n.createElement)("h1",null,"Insert Role Below"),(0,n.createElement)("p",null,(0,n.createElement)(s.SelectControl,{label:"Role",value:b.role,options:E,onChange:e=>{k((t=>({...t,role:e,time_allowed:L(t.time_allowed,e,t.count)})))}})),"custom"==b.role&&(0,n.createElement)("p",null,(0,n.createElement)(s.TextControl,{value:b.custom_role,onChange:e=>{k((t=>({...t,custom_role:e})))}})),(0,n.createElement)("p",null,(0,n.createElement)(s.__experimentalNumberControl,{label:"Count",min:"1",value:b.count,onChange:e=>{k((t=>({...t,count:e,time_allowed:L(t.time_allowed,t.role,e)})))}})," ",(0,n.createElement)("em",null,"How many members can take this role?")),(0,n.createElement)("p",null,(0,n.createElement)(s.__experimentalNumberControl,{label:"Time Allowed",min:"0",value:b.time_allowed,onChange:e=>{k((t=>({...t,time_allowed:e})))}})),"Speaker"==b.role&&(0,n.createElement)("p",null,(0,n.createElement)(s.__experimentalNumberControl,{label:"Padding Time",min:"0",value:b.padding_time,onChange:e=>{k((t=>({...t,padding_time:e})))}})," ",(0,n.createElement)("em",null,"A little extra time for switching and introducing speakers")),(0,n.createElement)(s.ToggleControl,{label:"Backup",help:1==b.backup?"Editing":"Viewing",checked:b.backup,onChange:()=>{k((e=>({...e,backup:!b.backup})))}}),(0,n.createElement)("p",null,(0,n.createElement)("button",{className:"blockmove",onClick:()=>{I()}},"Save"))):"wp4toastmasters/agendanoterich2"==t?(0,n.createElement)(n.Fragment,null,(0,n.createElement)(M,null),(0,n.createElement)(d.M,{onInit:(e,t)=>(k((e=>({...e,uid:"note"+Date.now()}))),x.current=t),initialValue:"",init:{height:100,menubar:!1,toolbar:"undo redo | bold italic | removeformat",content_style:"body { font-family:Helvetica,Arial,sans-serif; font-size:14px }"}}),(0,n.createElement)("p",null,(0,n.createElement)(s.__experimentalNumberControl,{label:"Time Allowed",min:"0",value:b.time_allowed,onChange:e=>{k((t=>({...t,time_allowed:e})))}})),(0,n.createElement)("p",null,(0,n.createElement)("button",{className:"blockmove",onClick:()=>{I()}},"Save")),(0,n.createElement)("p",null,"This text will appear on the agenda, with a timestamp if Time Allowed is set.")):"wp4toastmasters/signupnote"==t?(0,n.createElement)(n.Fragment,null,(0,n.createElement)(M,null),(0,n.createElement)(d.M,{onInit:(e,t)=>(k((e=>({...e,uid:"note"+Date.now()}))),x.current=t),initialValue:"",init:{height:100,menubar:!1,toolbar:"undo redo | bold italic | removeformat",content_style:"body { font-family:Helvetica,Arial,sans-serif; font-size:14px }"}}),(0,n.createElement)("p",null,(0,n.createElement)("button",{className:"blockmove",onClick:()=>{I()}},"Save")),(0,n.createElement)("p",null,"This text will appear on the signup form, and ",(0,n.createElement)("strong",null,"NOT")," on the agenda.")):"wp4toastmasters/agendaedit"==t?(0,n.createElement)(n.Fragment,null,(0,n.createElement)(M,null),(0,n.createElement)(u.U,{makeNotification:C,post_id:_,block:{attrs:{editable:"",uid:Date.now(),time_allowed:0,edithtml:""}},mode:"organize",insertBlock:v,blockindex:w,setInsert:a}),(0,n.createElement)("p",null,"Entering text is optional and will apply to ",(0,n.createElement)("em",null,"this specific event.")," The Editable Note is meant to be used for content that changes from meeting to meeting, such as the meeting theme or word of the day.")):(0,n.createElement)(M,null)}var b=a(175),k=a(169),E=a(183),h=a(300),w=a(144);function v(e){const{data:t,mode:a,ModeControl:m,post_id:d,showDetails:v,setshowDetails:f,makeNotification:_}=e,[N,C]=(0,o.useState)(!0),[x,S]=(0,o.useState)(-1),{mutate:y}=(0,w.tz)(d,_,p);if("reorganize"!=a)return null;function T(e){let t=0,a=e.count?e.count:1;return"Speaker"==e.role&&(t=7*a),"Evaluator"==e.role&&(t=3*a),t}function D(){let e=[];return t.blocksdata.map(((t,a)=>{e.push(a)})),e}function A(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"up";if(console.log("reorg moveBlock param",e+","+a),0==e&&"up"==a)return;let l=D();console.log("moveable",l);let n=parseInt(a),o=l.indexOf(e);if(console.log("reorg found index "+o+" for blockindex"+e),"up"==a?n=l[o-1]:"down"==a&&(n=l[o+2]),"delete"==a)console.log("delete from "+e),t.blocksdata.splice(e,1);else{console.log("reorg new position:"+n+" from "+e),console.log("reorg move blocks, current blocks",t.blocksdata);let a=t.blocksdata[e];t.blocksdata[e]={blockName:null},t.blocksdata.splice(n,0,a),console.log("reorg move "+e+" to "+n)}console.log("reorg move blocks, new blocks",t.blocksdata),t.changed="blocks",y(t)}function B(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"wp4toastmasters/role",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",r=[];Array.isArray(t.blocksdata)&&t.blocksdata.forEach(((t,s)=>{r.push(t),s==e&&(console.log("newblock",{blockName:l,DnDid:"temp"+Date.now(),assignments:[],attrs:a,innerHTML:n,edithtml:o}),r.push({blockName:l,assignments:[],attrs:a,innerHTML:n,edithtml:o}))})),t.blocksdata=r,y(t)}function H(e,a){let l=[];t.blocksdata.forEach(((t,n)=>{n==e?l.push(a):l.push(t)})),t.blocksdata=l,y(t)}let M=new Date(t.datetime);const I=M.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"});return t.blocksdata.map(((e,a)=>{t.blocksdata[a].datestring=M.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}),e?.attrs?.time_allowed&&(M.setMilliseconds(M.getMilliseconds()+6e4*parseInt(e.attrs.time_allowed)),e.attrs.padding_time&&M.setMilliseconds(M.getMilliseconds()+6e4*parseInt(e.attrs.padding_time)),t.blocksdata[a].datestring=t.blocksdata[a].datestring.concat(" to "+M.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})))})),D(),(0,n.createElement)(h.Z5,{onDragEnd:function(e){const a=[];if(!e.destination)return;const l=e.source.index,n=e.destination.index;let o=t.blocksdata[l];console.log("drag source",l),console.log("drag destination",n),t.blocksdata.forEach(((e,t)=>{t!=l?(a.push(e),t==n&&(console.log("drag add moved "+t),console.log("drag add current block",e),console.log("drag add myblock",o),a.push(o),o=null)):console.log("drag skip "+t)})),o&&a.push(o),y({...t,blocksdata:a})}},(0,n.createElement)("div",{className:"agendawrapper",id:"agendawrapper"+d},(0,n.createElement)(n.Fragment,null,"rsvpmaker"!=wpt_rest.post_type&&(0,n.createElement)(s.SelectControl,{label:"Choose Event",value:d,options:t.upcoming,onChange:e=>{setPostId(parseInt(e)),_("Date changed, please wait for the date to change ..."),queryClient.invalidateQueries(["blocks-data",d]),refetch()}})),(0,n.createElement)("h4",null,I," ",t.is_template&&(0,n.createElement)("span",null,"(Template)")," "),(0,n.createElement)(m,{makeNotification:_}),(0,n.createElement)(h.bK,{droppableId:"droppable"},((e,o)=>(0,n.createElement)("div",(0,l.Z)({},e.droppableProps,{ref:e.innerRef,style:(o.isDraggingOver,{background:"white"})}),t.blocksdata.map(((m,w)=>m.blockName?(m.blockName.replace(/^[^/]+\//,""),(0,n.createElement)(n.Fragment,null,(0,n.createElement)("div",{className:"reorgdrag"},(0,n.createElement)("div",{className:"reorgdragup"},(0,n.createElement)("button",{className:"blockmove",onClick:()=>{A(w,"up")}},(0,n.createElement)(g.Up,null))),(0,n.createElement)("div",{className:"reorgdragdown"},(0,n.createElement)("button",{className:"blockmove",onClick:()=>{A(w,"down")}},(0,n.createElement)(g.Rk,null))," ",(0,n.createElement)("button",{className:"blockmove",onClick:()=>{S(w)}},(0,n.createElement)(g.JW,null)),x==w&&(0,n.createElement)("p",null,"Down up control goes here")),(0,n.createElement)("div",{className:"reorganize-drag"},(0,n.createElement)(h._l,{key:m.DnDid,draggableId:m.DnDid,index:w},((e,t)=>{return t.isDragging&&(v&&(f(!1),_("Switching to outline view for drag-and-drop")),console.log("snapshot",t)),(0,n.createElement)("div",(0,l.Z)({ref:e.innerRef},e.draggableProps,e.dragHandleProps,{style:(a=t.isDragging,o=e.draggableProps.style,{userSelect:"none",minHeight:"52px",background:a?"lightgreen":"#EFEFEF",borderBottom:"medium solid #7C2128",marginBottom:"5px",...o})}),(0,n.createElement)("div",null,(0,n.createElement)("strong",null,m.datestring)),(0,n.createElement)("h2",null,m.blockName.replace(/^[^/]+\//,"").replace("agendanoterich2","agenda note"),": ",m.attrs.role&&(0,n.createElement)("span",null,m.attrs.role)," ",m.attrs.editable&&(0,n.createElement)("span",null,m.attrs.editable)," ",m.innerHTML&&(0,n.createElement)("span",null,function(e){let t=e.replaceAll(/<[^>]+>/g," ");return t.length>150&&(t=t.substring(0,150)+"..."),t}(m.innerHTML))));var a,o}))),v&&"wp4toastmasters/help"==m.blockName&&(0,n.createElement)("p",null,"See the knowledge base article ",(0,n.createElement)("a",{href:"https://www.wp4toastmasters.com/knowledge-base/editing-agendas-and-agenda-templates-with-the-front-end-organize-screen/"},"Editing agendas and agenda templates with the front-end Organize screen")," for video and written instructions."),v&&"wp4toastmasters/role"==m.blockName&&(0,n.createElement)("div",null,v&&(0,n.createElement)(i.Z,{makeNotification:_,agendadata:t,block:m,apiClient:r.Z,blockindex:w,mode:a}),(0,n.createElement)("div",{className:"tmflexrow"},(0,n.createElement)("div",{className:"tmflex30"},(0,n.createElement)(s.__experimentalNumberControl,{label:"Signup Slots",min:"1",value:m.attrs.count?m.attrs.count:1,onChange:e=>{var a,l;t.blocksdata[w].attrs.count=e,["Speaker","Evaluator"].includes(m.attrs.role)&&(t.blocksdata[w].attrs.time_allowed=T(m.attrs),t.blocksdata=(a=t.blocksdata,l=e,N?(a.forEach(((e,t)=>{"Evaluator"==e.attrs.role&&(a[t].attrs.count=l,a[t].attrs.time_allowed=3*l)})),a):a)),y(t)}})),(0,n.createElement)("div",{className:"tmflex30"},(0,n.createElement)(s.__experimentalNumberControl,{label:"Time Allowed",value:m.attrs?.time_allowed?m.attrs?.time_allowed:T(m.attrs),onChange:e=>{t.blocksdata[w].attrs.time_allowed=e,y(t)}}))," ","Speaker"==m.attrs.role&&(0,n.createElement)("div",{className:"tmflex30"},(0,n.createElement)(s.__experimentalNumberControl,{label:"Padding Time",min:"0",value:m.attrs.padding_time,onChange:e=>{t.blocksdata[w].attrs.padding_time=e,y(t)}}))),"Speaker"==m.attrs.role&&(0,n.createElement)("div",null,(0,n.createElement)("p",null,(0,n.createElement)("em",null,"Padding time is a little extra time for switching between and introducing speakers (not included in the time allowed for speeches).")),(0,n.createElement)("p",null,(0,n.createElement)(s.ToggleControl,{label:"Sync Number of Speakers and Evaluators",help:1==N?"Number of evaluators will automatically changed with number of speakers":"Let me manage this manually",checked:N,onChange:()=>{C(!N)}}))),(0,n.createElement)("p",null,(0,n.createElement)(s.ToggleControl,{label:"Backup",help:1==m.attrs.backup?"Editing":"Viewing",checked:m.attrs.backup,onChange:()=>{t.blocksdata[w].attrs.backup=!m.attrs.backup,y(t)}})),(0,n.createElement)(c.t,{block:m,makeNotification:_})),v&&"wp4toastmasters/absences"==m.blockName&&(0,n.createElement)("div",null,(0,n.createElement)(s.ToggleControl,{label:"Show on Agenda",help:1==m.attrs.backup?"Show":"Hide",checked:m.attrs.show_on_agenda,onChange:()=>{t.blocksdata[w].attrs.show_on_agenda=!m.attrs.show_on_agenda,y(t)}})),v&&"wp4toastmasters/agendaedit"==m.blockName&&(0,n.createElement)("div",null,v&&(0,n.createElement)(u.U,{makeNotification:_,mode:a,block:m,blockindex:w,uid:m.attrs.uid,post_id:d}),(0,n.createElement)("div",{className:"tmflexrow"},(0,n.createElement)("div",{className:"tmflex30"},(0,n.createElement)(s.__experimentalNumberControl,{label:"Time Allowed",value:m.attrs?.time_allowed?m.attrs?.time_allowed:0,onChange:e=>{t.blocksdata[w].attrs.time_allowed=e,y(t)}})))),v&&"wp4toastmasters/agendanoterich2"==m.blockName&&(0,n.createElement)("div",null,v&&(0,n.createElement)(k.B,{makeNotification:_,blockindex:w,block:m,replaceBlock:H}),(0,n.createElement)("div",{className:"tmflexrow"},(0,n.createElement)("div",{className:"tmflex30"},(0,n.createElement)(s.__experimentalNumberControl,{label:"Time Allowed",value:m.attrs?.time_allowed?m.attrs?.time_allowed:0,onChange:e=>{t.blocksdata[w].attrs.time_allowed=e,y(t)}})))),v&&"wp4toastmasters/signupnote"==m.blockName&&(0,n.createElement)("div",null,(0,n.createElement)(E.k,{blockindex:w,block:m,replaceBlock:H})),v&&m.innerHTML&&!["wp4toastmasters/signupnote","wp4toastmasters/agendanoterich2"].includes(m.blockname)&&(0,n.createElement)(b.U,{innerHTML:m.innerHTML}),v&&(0,n.createElement)(p,{makeNotification:_,blockindex:w,insertBlock:B,moveBlock:A,post_id:d})),o.isDraggingOver&&e.placeholder)):null)))))))}}}]);